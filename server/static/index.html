<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/pico.classless.min.css">
    <title>Frame</title>
</head>
<body>
<main>
    <form id="form" enctype="multipart/form-data">
        <h1>Family Frame</h1>
        <h2>File</h2>
        <input type="file" name="file" accept="image/*" required="required"/>
        <h2>Day</h2>
        <fieldset role="group">
            <label><input type="radio" name="day" value="1" required="required"/>Monday</label>
            <label><input type="radio" name="day" value="2" required="required"/>Tuesday</label>
            <label><input type="radio" name="day" value="3" required="required"/>Wednesday</label>
            <label><input type="radio" name="day" value="4" required="required"/>Thursday</label>
            <label><input type="radio" name="day" value="5" required="required"/>Friday</label>
            <label><input type="radio" name="day" value="6" required="required"/>Saturday</label>
            <label><input type="radio" name="day" value="7" required="required"/>Sunday</label>
        </fieldset>
        <h2>Time</h2>
        <fieldset>
<!--            <label><input type="radio" name="hour" value="0"/>12:00AM</label>-->
<!--            <label><input type="radio" name="hour" value="1"/>1:00AM</label>-->
<!--            <label><input type="radio" name="hour" value="2"/>2:00AM</label>-->
<!--            <label><input type="radio" name="hour" value="3"/>3:00AM</label>-->
<!--            <label><input type="radio" name="hour" value="4"/>4:00AM</label>-->
            <label><input type="radio" name="hour" value="5" required="required"/>5:00AM<img src="thumbs/none.jpeg" alt="5am photo"/></label>
<!--            <label><input type="radio" name="hour" value="6"/>6:00AM</label>-->
<!--            <label><input type="radio" name="hour" value="7"/>7:00AM</label>-->
<!--            <label><input type="radio" name="hour" value="8"/>8:00AM</label>-->
<!--            <label><input type="radio" name="hour" value="9"/>9:00AM</label>-->
<!--            <label><input type="radio" name="hour" value="10"/>10:00AM</label>-->
<!--            <label><input type="radio" name="hour" value="11"/>11:00AM</label>-->
            <label><input type="radio" name="hour" value="12" required="required"/>12:00PM<img src="thumbs/none.jpeg" alt="5am photo"/></label>
<!--            <label><input type="radio" name="hour" value="13"/>1:00PM</label>-->
<!--            <label><input type="radio" name="hour" value="14"/>2:00PM</label>-->
<!--            <label><input type="radio" name="hour" value="15"/>3:00PM</label>-->
<!--            <label><input type="radio" name="hour" value="16"/>4:00PM</label>-->
<!--            <label><input type="radio" name="hour" value="17"/>5:00PM</label>-->
            <label><input type="radio" name="hour" value="18" required="required"/>6:00PM<img src="thumbs/none.jpeg" alt="5am photo"/></label>
<!--            <label><input type="radio" name="hour" value="19"/>7:00PM</label>-->
<!--            <label><input type="radio" name="hour" value="20"/>8:00PM</label>-->
<!--            <label><input type="radio" name="hour" value="21"/>9:00PM</label>-->
<!--            <label><input type="radio" name="hour" value="22"/>10:00PM</label>-->
<!--            <label><input type="radio" name="hour" value="23"/>11:00PM</label>-->
        </fieldset>
        <label>Display when done uploading<input type="checkbox" name="show_now" value="1"></label>
        <input type="submit" id="submit"/>
    </form>
</main>
<dialog id="successModal" closedby="any">
    <article>
        <header>
            <button aria-label="Close" rel="prev" onclick="successModal.close()"></button>
            <h3>Uploaded successfully</h3>
        </header>
        <p>The file has been uploaded. It'll start dithering, and should be done in a minute or so.</p>
        <footer>
            <button autofocus role="button" onclick="successModal.close()">Great!</button>
        </footer>
    </article>
</dialog>
<script>
    const form = document.querySelector("#form");

    form.addEventListener("submit", async (event) => {
        event.preventDefault();
        const day = document.querySelector("input[name='day']:checked").value;
        const hour =  document.querySelector("input[name='hour']:checked").value;

        const self = event.target;
        self.disabled = true;
        self.text = "Submitted...";

        const formData = new FormData(form);
        formData.append("json", JSON.stringify({show_now: document.querySelector("input[name='show_now']").checked}))
        const response = await fetch("/upload/" + day + "/" + hour, {
            method: "POST",
            body: formData,
        });
        if (response.ok) {
            successModal.show();
        }
    });

    for (const day of document.querySelectorAll("input[name='day']")) {
        day.addEventListener("change", async (event) => {
            const day = event.target.value;
            debugger
            for (const hourElem of document.querySelectorAll("input[name='hour']")) {
                const image = hourElem.parentElement.querySelector("img");
                if (!!image) {
                    image.src = `thumbs/${day}/${hourElem.value}.jpeg`
                }
            }
        });
    }
</script>
</body>
</html>
